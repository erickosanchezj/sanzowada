<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanzo Wada Color Palettes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.5s ease;
        }
        .color-swatch {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .color-swatch:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .color-info-panel {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.75);
        }
        .palette-card {
            border: 1px solid rgba(0,0,0,0.05);
            transition: box-shadow 0.3s ease;
        }
        .palette-card:hover {
             box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        /* Styles for the main color index */
        .main-palette-swatch {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: filter 0.2s ease;
        }
        .main-palette-swatch:hover {
            filter: brightness(1.1);
        }
        .swatch-info {
            position: absolute;
            padding: 0.75rem;
            font-size: 0.875rem;
            opacity: 0.8;
        }
        .text-stroke {
             color: white;
             text-shadow:
                 -1px -1px 0 #000,  
                  1px -1px 0 #000,
                 -1px  1px 0 #000,
                  1px  1px 0 #000;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="min-h-screen">
        <!-- Main Content -->
        <main class="p-4 sm:p-6 lg:p-8">
            <div class="max-w-7xl mx-auto">
                <header class="text-center mb-12">
                     <h1 class="text-2xl sm:text-4xl lg:text-5xl font-bold mb-2 text-stroke">A Dictionary of Color Combinations</h1>
                     <p class="text-lg text-stroke">Based on the work of Sanzo Wada</p>
                </header>

                <!-- Selected Color Information -->
                <div id="selected-color-section" class="mb-12 lg:sticky top-4 z-10">
                     <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-center">
                        <div id="selected-color-display" class="hidden lg:block h-40 lg:h-64 rounded-xl shadow-lg border-4 border-white"></div>
                        <div class="lg:col-span-2">
                             <div class="color-info-panel p-6 rounded-xl shadow-md border border-gray-200/50">
                                <h2 id="color-name" class="text-2xl font-bold text-gray-900"></h2>
                                <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-4 text-gray-700">
                                    <div>
                                        <p class="font-semibold text-sm text-gray-500">HEX</p>
                                        <p id="color-hex" class="font-mono"></p>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-sm text-gray-500">RGB</p>
                                        <p id="color-rgb" class="font-mono text-sm"></p>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-sm text-gray-500">CMYK</p>
                                        <p id="color-cmyk" class="font-mono text-sm"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Color Combinations -->
                <div id="combinations-section" class="mb-12">
                    <h3 id="palettes-heading" class="text-xl lg:text-2xl font-semibold text-gray-800 mb-6">Palettes Featuring This Color</h3>
                    <div id="combinations-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Combination palettes will be inserted here -->
                    </div>
                </div>


                <!-- All Colors Grid -->
                <div class="border-t pt-10">
                    <h3 class="text-xl lg:text-2xl font-semibold text-gray-800 mb-6">Complete Color Index</h3>
                    <div id="colors-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-0">
                        <!-- Color swatches will be inserted here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <button id="to-top-button" 
            class="hidden fixed bottom-5 right-5 z-20 bg-gray-800/70 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center backdrop-filter backdrop-blur-sm transition-opacity duration-300 hover:bg-gray-900"
            title="Go to top">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
    </button>

    <script>
        let colorsData = [];
        const colorsGrid = document.getElementById('colors-grid');
        const combinationsGrid = document.getElementById('combinations-grid');
        const selectedColorDisplay = document.getElementById('selected-color-display');
        const colorName = document.getElementById('color-name');
        const colorHex = document.getElementById('color-hex');
        const colorRgb = document.getElementById('color-rgb');
        const colorCmyk = document.getElementById('color-cmyk');
        const palettesHeading = document.getElementById('palettes-heading');
        const toTopButton = document.getElementById('to-top-button');

        /**
         * Creates a consistent status message markup for grid containers.
         * @param {string} message - The message to render.
         * @returns {string} The HTML string representing the message block.
         */
        function createStatusMessage(message) {
            return `<p class="col-span-full text-center text-gray-500">${message}</p>`;
        }

        /**
         * Resets the selected color panel to its default state.
         */
        function resetSelectedColor() {
            document.body.style.backgroundColor = '';
            selectedColorDisplay.style.backgroundColor = '';
            colorName.textContent = '';
            colorHex.textContent = '';
            colorRgb.textContent = '';
            colorCmyk.textContent = '';
        }

        /**
         * Displays a lightweight loading state while data is being fetched.
         */
        function showLoadingState() {
            resetSelectedColor();
            colorName.textContent = 'Loading…';
            colorsGrid.innerHTML = createStatusMessage('Loading color data…');
            combinationsGrid.innerHTML = createStatusMessage('Loading color combinations…');
            palettesHeading.textContent = 'Palettes Featuring This Color';
        }

        /**
         * Renders an error message when the color data cannot be fetched.
         * @param {string} message - The friendly error message to display.
         */
        function showErrorState(message) {
            resetSelectedColor();
            colorName.textContent = 'Unable to load colors';
            colorsGrid.innerHTML = createStatusMessage(message);
            combinationsGrid.innerHTML = '';
            palettesHeading.textContent = 'Palettes Featuring This Color';
        }

        /**
         * Determines if a color is light or dark and returns the best contrasting color (black or white).
         * @param {string} hexcolor - The hex color string (e.g., "#RRGGBB").
         * @returns {string} 'black' or 'white'.
         */
        function getContrastYIQ(hexcolor){
            hexcolor = hexcolor.replace("#", "");
            const r = parseInt(hexcolor.substr(0,2),16);
            const g = parseInt(hexcolor.substr(2,2),16);
            const b = parseInt(hexcolor.substr(4,2),16);
            const yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 128) ? 'black' : 'white';
        }

        /**
         * Finds a color object by its index.
         * @param {number} index - The index of the color to find.
         * @returns {object|undefined} The color object or undefined if not found.
         */
        function findColorByIndex(index) {
            return colorsData.find(color => color.index === index);
        }

        /**
         * Updates the UI to display the details of a selected color and its combinations.
         * @param {object} color - The color object to display.
         */
        function selectColor(color) {
            if (!color) {
                return;
            }
            // Update main display
            document.body.style.backgroundColor = color.hex;
            selectedColorDisplay.style.backgroundColor = color.hex;
            colorName.textContent = color.name;
            colorHex.textContent = color.hex;
            colorRgb.textContent = color.rgb;
            colorCmyk.textContent = color.cmyk;

            // Clear previous combinations
            combinationsGrid.innerHTML = '';

            // Get the list of combination IDs the selected color belongs to.
            const combinationIds = color.combinations;

            if (combinationIds && combinationIds.length > 0) {
                palettesHeading.textContent = `Palettes Featuring This Color (${combinationIds.length})`;
            } else {
                palettesHeading.textContent = 'Palettes Featuring This Color';
            }

            if (combinationIds && combinationIds.length > 0) {
                // For each combination ID, find all the other colors that share it.
                combinationIds.forEach(comboId => {
                    const palette = colorsData.filter(c => c.combinations.includes(comboId));

                    const paletteCard = document.createElement('div');
                    paletteCard.className = 'palette-card bg-white rounded-lg shadow-sm overflow-hidden';

                    const paletteHeader = document.createElement('div');
                    paletteHeader.className = 'p-3 bg-gray-50 border-b';
                    paletteHeader.innerHTML = `<h4 class="font-semibold text-sm text-gray-700">Combination #${comboId}</h4>`;
                    paletteCard.appendChild(paletteHeader);

                    const paletteSwatches = document.createElement('div');
                    // --- CHANGE IS HERE ---
                    // Updated grid for square swatches
                    paletteSwatches.className = 'p-3 grid grid-cols-2 gap-2';
                    
                    const paletteFragment = document.createDocumentFragment();

                    palette.forEach(comboColor => {
                        const swatch = document.createElement('div');
                        // Added relative and aspect-square for the new style
                        swatch.className = 'relative aspect-square cursor-pointer color-swatch';
                        swatch.style.backgroundColor = comboColor.hex;
                        swatch.title = comboColor.name;

                        // Set text color based on background brightness
                        const textColor = getContrastYIQ(comboColor.hex);
                        swatch.style.color = textColor;

                        // Create and append info elements for HEX and Name
                        const hexEl = document.createElement('span');
                        hexEl.className = 'absolute top-2 left-2 text-xs font-mono opacity-80';
                        hexEl.textContent = comboColor.hex;

                        const nameEl = document.createElement('span');
                        nameEl.className = 'absolute bottom-2 right-2 text-xs text-right opacity-80 truncate';
                        nameEl.textContent = comboColor.name;
                        
                        swatch.appendChild(hexEl);
                        swatch.appendChild(nameEl);

                        swatch.addEventListener('click', (e) => {
                            e.stopPropagation();
                            selectColor(comboColor);
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        });

                        paletteFragment.appendChild(swatch);
                    });
                    // --- END OF CHANGE ---

                    paletteSwatches.appendChild(paletteFragment);

                    paletteCard.appendChild(paletteSwatches);
                    combinationsGrid.appendChild(paletteCard);
                });
            } else {
                 combinationsGrid.innerHTML = '<p class="text-gray-500 col-span-full text-center">No combinations available for this color.</p>';
            }
        }

        // Show the button when the user scrolls down
        window.onscroll = function() {
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                toTopButton.classList.remove('hidden');
            } else {
                toTopButton.classList.add('hidden');
            }
        };

        // Scroll to the top when the button is clicked
        toTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        /**
         * Initializes the application.
         */
        function init() {
            colorsGrid.innerHTML = '';
            if (!colorsData.length) {
                showErrorState('No colors found in the dataset.');
                return;
            }
            // Populate the main grid with all colors
            const swatchFragment = document.createDocumentFragment();

            colorsData.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = 'main-palette-swatch h-36 sm:h-48';
                swatch.style.backgroundColor = color.hex;
                swatch.title = color.name;
                
                const textColor = getContrastYIQ(color.hex);
                swatch.style.color = textColor;

                // Create and append info elements
                const indexEl = document.createElement('span');
                indexEl.className = 'swatch-info top-0 left-0';
                indexEl.textContent = `${color.index} (${color.combinations.length})`;
                
                const hexEl = document.createElement('span');
                // CHANGE: Added w-1/2 to limit width
                hexEl.className = 'swatch-info bottom-0 left-0 font-mono w-1/2';
                hexEl.textContent = color.hex;

                const nameEl = document.createElement('span');
                // CHANGE: Added w-1/2 to limit width and 'truncate' for ellipsis on long names
                nameEl.className = 'swatch-info bottom-0 right-0 text-right w-1/2 truncate';
                nameEl.textContent = color.name;

                swatch.appendChild(indexEl);
                swatch.appendChild(hexEl);
                swatch.appendChild(nameEl);

                swatch.addEventListener('click', () => {
                    selectColor(color);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
                swatchFragment.appendChild(swatch);
            });

            colorsGrid.appendChild(swatchFragment);

            // Select the first color by default
            if (colorsData.length > 0) {
                selectColor(colorsData[0]);
            }
        }

        /**
         * Bootstraps the application by asynchronously loading the color data.
         */
        async function bootstrap() {
            showLoadingState();
            try {
                const response = await fetch('data/colors.json');
                if (!response.ok) {
                    throw new Error(`Request failed with status ${response.status}`);
                }

                const jsonData = await response.json();
                const fetchedColors = Array.isArray(jsonData?.colors) ? jsonData.colors : [];

                if (!fetchedColors.length) {
                    throw new Error('No color entries found.');
                }

                colorsData = fetchedColors;
                init();
            } catch (error) {
                console.error('Failed to load color data', error);
                showErrorState('We were unable to load the color palettes. Please refresh the page to try again.');
            }
        }

        document.addEventListener('DOMContentLoaded', bootstrap);
    </script>
</body>
</html>
